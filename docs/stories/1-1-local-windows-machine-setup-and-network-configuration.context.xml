<?xml version="1.0" encoding="UTF-8"?>
<story-context id="1-1-local-windows-machine-setup-and-network-configuration" v="1.0">
  <metadata>
    <epicId>1</epicId>
    <storyId>1.1</storyId>
    <title>Local Windows Machine Setup and Network Configuration</title>
    <status>drafted</status>
    <generatedAt>2025-11-12</generatedAt>
    <generator>BMAD Story Context Workflow with MCP Enhancement</generator>
    <sourceStoryPath>docs/stories/1-1-local-windows-machine-setup-and-network-configuration.md</sourceStoryPath>
  </metadata>

  <story>
    <asA>backend developer</asA>
    <iWant>my local Windows computer configured for MT5 service development with network access from my Mac</iWant>
    <soThat>I can test the full integration locally before spending money on VPS hosting</soThat>
    <tasks>
      - Windows System Updates and Prerequisites
      - Network Configuration and Static IP Assignment (192.168.1.100)
      - PowerShell Configuration (RemoteSigned execution policy)
      - Windows Defender Firewall Configuration (port 8000 inbound)
      - Chocolatey Package Manager Installation
      - Connectivity Testing from Mac (ping, traceroute)
      - Optional: Remote Desktop enabling
      - Documentation and Final Verification
    </tasks>
  </story>

  <acceptanceCriteria>
    <criterion id="1" verification="winver shows Windows 10/11 with latest build">
      Windows machine is updated to latest version
    </criterion>
    <criterion id="2" verification="ipconfig shows static IP, IP documented in .env file">
      Static IP address assigned and documented (e.g., 192.168.1.100)
    </criterion>
    <criterion id="3" verification="Get-ExecutionPolicy returns RemoteSigned or Unrestricted">
      PowerShell execution policy allows scripts
    </criterion>
    <criterion id="4" verification='Get-NetFirewallRule -DisplayName "MT5 FastAPI Local Dev" succeeds'>
      Windows Defender firewall rule created for port 8000
    </criterion>
    <criterion id="5" verification="choco --version returns version number">
      Chocolatey package manager installed
    </criterion>
    <criterion id="6" verification="ping 192.168.1.100 from Mac terminal receives responses">
      Mac can ping Windows IP address
    </criterion>
    <criterion id="7" verification="Can connect via RDP from Mac using Microsoft Remote Desktop">
      (Optional) Remote Desktop enabled for Mac access
    </criterion>
  </acceptanceCriteria>

  <artifacts>
    <docs>
      <doc>
        <path>docs/LOCAL-DEVELOPMENT-GUIDE.md</path>
        <title>Local Development Guide - MT5 Integration Service</title>
        <section>Step 1: Windows Machine Network Configuration</section>
        <snippet>
          Complete step-by-step instructions for Windows network configuration including:
          - Finding current IP address with ipconfig
          - Setting static IP via Settings GUI or PowerShell (New-NetIPAddress)
          - Configuring Windows Firewall with New-NetFirewallRule
          - Testing connectivity from Mac with ping/traceroute
          - Recommended IP: 192.168.1.100 with subnet 255.255.255.0, gateway 192.168.1.1, DNS 8.8.8.8
        </snippet>
        <relevance>Primary implementation guide for this story - contains exact PowerShell commands</relevance>
      </doc>
      
      <doc>
        <path>docs/technical/WINDOWS-DEPLOYMENT-GUIDE.md</path>
        <title>Windows VPS Deployment Guide</title>
        <section>2. Initial Windows Setup</section>
        <snippet>
          Windows Server 2022 initial setup procedures adapted for local Windows 10/11:
          - PowerShell execution policy configuration
          - Windows Defender firewall management
          - Chocolatey installation script
          - Remote Desktop configuration
          Note: This story adapts VPS setup for local development environment
        </snippet>
        <relevance>Reference for Windows-specific commands and best practices</relevance>
      </doc>
      
      <doc>
        <path>docs/epics.md</path>
        <title>Epic Breakdown</title>
        <section>Epic 1: Foundation & Infrastructure - Story 1.1</section>
        <snippet>
          Business value: Local development eliminates VPS costs during development ($0 vs €15-25/month),
          enables faster debugging, and reduces risk by validating everything before production deployment.
          Technical notes: Static IP setup via Windows Settings or PowerShell, firewall rule is local network only (safe for development),
          future migration path to VPS with public IP is straightforward.
        </snippet>
        <relevance>Business context and rationale for local-first approach</relevance>
      </doc>
      
      <doc>
        <path>docs/PRD-MT5-Integration-Service.md</path>
        <title>Product Requirements Document</title>
        <section>6. Technical Stack - Infrastructure</section>
        <snippet>
          Platform: Windows 10/11 or Windows Server 2022
          Development approach: Local development first, then VPS migration
          Network requirements: Static IP for stability, port 8000 for FastAPI service
          Cost optimization: Validate locally ($0 cost) before VPS commitment (€15-25/month)
        </snippet>
        <relevance>Infrastructure requirements and platform specifications</relevance>
      </doc>
    </docs>

    <code>
      <artifact>
        <path>N/A</path>
        <kind>infrastructure</kind>
        <symbol>N/A</symbol>
        <lines>N/A</lines>
        <reason>This is the first story - no existing code yet. Story establishes infrastructure foundation.</reason>
      </artifact>
    </code>

    <dependencies>
      <dependency>
        <name>Windows 10/11</name>
        <version>Build 19042+ (Windows 10) or any (Windows 11)</version>
        <purpose>Operating system for MT5 Terminal and Python service</purpose>
        <installation>Built-in - ensure latest updates installed</installation>
      </dependency>
      
      <dependency>
        <name>PowerShell</name>
        <version>5.1+ (built-in with Windows)</version>
        <purpose>Windows automation and configuration management</purpose>
        <installation>Pre-installed with Windows 10/11</installation>
      </dependency>
      
      <dependency>
        <name>Chocolatey</name>
        <version>Latest (2.3.0+)</version>
        <purpose>Windows package manager for software installation</purpose>
        <installation>
          PowerShell (Run as Administrator):
          Set-ExecutionPolicy Bypass -Scope Process -Force;
          [System.Net.ServicePointManager]::SecurityProtocol = [System.Net.ServicePointManager]::SecurityProtocol -bor 3072;
          iex ((New-Object System.Net.WebClient).DownloadString('https://community.chocolatey.org/install.ps1'))
        </installation>
      </dependency>
      
      <dependency>
        <name>Microsoft Remote Desktop</name>
        <version>Latest</version>
        <purpose>Optional: Remote access to Windows machine from Mac</purpose>
        <installation>Mac App Store (free)</installation>
      </dependency>
    </dependencies>
  </artifacts>

  <constraints>
    <constraint type="network">
      <description>Both Mac and Windows must be on same Wi-Fi or Ethernet network (192.168.x.x subnet)</description>
      <rationale>Local development requires direct network communication without VPN or routing complexity</rationale>
    </constraint>
    
    <constraint type="security">
      <description>Firewall rule limited to Private and Domain profiles (not Public)</description>
      <rationale>Port 8000 should only be accessible on trusted networks during development</rationale>
    </constraint>
    
    <constraint type="ip-addressing">
      <description>Static IP must be in same subnet as router and not conflict with DHCP range</description>
      <rationale>Dynamic IP changes would break configuration references in subsequent stories</rationale>
      <recommendation>Use 192.168.1.100 or 192.168.0.100 depending on router configuration</recommendation>
    </constraint>
    
    <constraint type="documentation">
      <description>IP address must be documented in docs/DEVELOPMENT-IPS.md for team reference</description>
      <rationale>All subsequent stories (1.2-1.8 and beyond) reference this IP address</rationale>
    </constraint>
    
    <constraint type="cost-optimization">
      <description>This approach saves €45-75 in VPS costs during weeks 1-3 of development</description>
      <rationale>No financial commitment until local validation complete (Story 1.8)</rationale>
    </constraint>
  </constraints>

  <interfaces>
    <interface>
      <name>Windows Network Adapter</name>
      <kind>system-interface</kind>
      <signature>
        Get-NetAdapter | Where-Object {$_.Status -eq "Up"}
        New-NetIPAddress -InterfaceAlias "Wi-Fi" -IPAddress 192.168.1.100 -PrefixLength 24 -DefaultGateway 192.168.1.1
        Set-DnsClientServerAddress -InterfaceAlias "Wi-Fi" -ServerAddresses ("8.8.8.8","8.8.4.4")
      </signature>
      <path>Windows PowerShell System Commands</path>
      <notes>Replace "Wi-Fi" with actual adapter name (could be "Ethernet", "Wi-Fi 2", etc.)</notes>
    </interface>
    
    <interface>
      <name>Windows Defender Firewall</name>
      <kind>system-interface</kind>
      <signature>
        New-NetFirewallRule -DisplayName "MT5 FastAPI Local Dev" 
          -Direction Inbound 
          -LocalPort 8000 
          -Protocol TCP 
          -Action Allow 
          -Profile Private,Domain
      </signature>
      <path>Windows PowerShell System Commands</path>
      <notes>Port 8000 matches FastAPI service configuration in Story 1.4</notes>
    </interface>
    
    <interface>
      <name>PowerShell Execution Policy</name>
      <kind>system-configuration</kind>
      <signature>
        Set-ExecutionPolicy -ExecutionPolicy RemoteSigned -Scope CurrentUser
      </signature>
      <path>Windows PowerShell System Commands</path>
      <notes>RemoteSigned allows local scripts, requires downloaded scripts to be signed</notes>
    </interface>
  </interfaces>

  <tests>
    <standards>
      <standard>All PowerShell commands must execute without errors</standard>
      <standard>Verification commands must confirm each acceptance criterion</standard>
      <standard>Network connectivity must be bidirectional (Mac → Windows and Windows → Mac)</standard>
      <standard>Screenshot evidence required for static IP and ping test results</standard>
    </standards>
    
    <locations>
      <location>
        <path>docs/STORY-1-1-COMPLETION-SUMMARY.md</path>
        <description>Manual verification document with test results</description>
      </location>
      <location>
        <path>docs/DEVELOPMENT-IPS.md</path>
        <description>IP address inventory document</description>
      </location>
    </locations>
    
    <ideas>
      <test>
        <name>Windows Version Verification</name>
        <command>winver</command>
        <expected>Windows 10 Build 19042+ or Windows 11</expected>
      </test>
      
      <test>
        <name>Static IP Verification</name>
        <command>ipconfig | findstr IPv4</command>
        <expected>IPv4 Address . . . . . . . . . . . : 192.168.1.100</expected>
      </test>
      
      <test>
        <name>Execution Policy Verification</name>
        <command>Get-ExecutionPolicy -Scope CurrentUser</command>
        <expected>RemoteSigned</expected>
      </test>
      
      <test>
        <name>Firewall Rule Verification</name>
        <command>Get-NetFirewallRule -DisplayName "MT5 FastAPI Local Dev"</command>
        <expected>Enabled: True, Direction: Inbound, Action: Allow</expected>
      </test>
      
      <test>
        <name>Chocolatey Installation Verification</name>
        <command>choco --version</command>
        <expected>Version number (e.g., 2.3.0)</expected>
      </test>
      
      <test>
        <name>Mac to Windows Connectivity</name>
        <command>ping 192.168.1.100 (from Mac terminal)</command>
        <expected>64 bytes from 192.168.1.100: icmp_seq=0 ttl=128 time=X.XXX ms</expected>
      </test>
      
      <test>
        <name>Network Route Verification</name>
        <command>traceroute 192.168.1.100 (from Mac terminal)</command>
        <expected>1-2 hops (Mac → Router → Windows)</expected>
      </test>
      
      <test>
        <name>Internet Connectivity After Static IP</name>
        <command>Test-NetConnection google.com</command>
        <expected>PingSucceeded : True</expected>
      </test>
    </ideas>
  </tests>

  <mcpEnhancements>
    <enhancement type="sequential-thinking" applied="yes">
      Used sequential-thinking MCP to analyze technical context requirements:
      - Thought 1: Identified need for PowerShell commands, network config patterns, Windows firewall best practices
      - Thought 2: Extracted relevant docs (LOCAL-DEVELOPMENT-GUIDE, WINDOWS-DEPLOYMENT-GUIDE, epics, PRD)
      - Thought 3: Defined key constraints (network topology, security, IP addressing, documentation, cost)
      - Thought 4: Specified 8 test scenarios with verification commands
      - Thought 5: Structured comprehensive context XML for autonomous dev agent implementation
    </enhancement>
    <enhancement type="context7" applied="ready">
      FastAPI CORS patterns retrieved for Story 1.4 (will be used when implementing API):
      - CORSMiddleware configuration for allow_origins
      - Local development origins: http://localhost:5173 (Mac frontend)
      - Full middleware setup with credentials/methods/headers
    </enhancement>
    <enhancement type="serena" applied="not-needed">
      No existing codebase yet (Story 1.1 is first story) - serena will be used from Story 2.1+ for code analysis
    </enhancement>
    <note>Future stories will leverage context7 for FastAPI/MT5 patterns, serena for codebase symbol analysis</note>
  </mcpEnhancements>
</story-context>
